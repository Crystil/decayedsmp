<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Decayed SMP Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        body {
          font-family: Orbitron, sans-serif;
          background: radial-gradient(circle at top, #1a0000, #000);
          color: #eee;
          padding: 3rem;
        }

        h1 {
          color: #b00000;
          text-align: center;
          margin-bottom: 3rem;
        }

        nav {
          display: flex;
          gap: 1rem;
          justify-content: center;
          margin-bottom: 3rem;
        }

        nav button {
          background: none;
          border: 2px solid #900;
          color: #fff;
          padding: 0.6rem 1.5rem;
          cursor: pointer;
        }

        nav button.active {
          background: #900;
        }

        .section {
          display: none;
        }

        .section.active {
          display: block;
        }

        .card {
          background: #0b0000;
          border: 1px solid #500;
          padding: 2rem;
          margin-bottom: 2rem;
          box-shadow: 0 0 20px #300;
        }

        .card h3 {
          color: #c00000;
          margin-bottom: 0.5rem;
        }

        .meta {
          opacity: 0.8;
          font-size: 0.9rem;
          margin-bottom: 1rem;
        }

        .actions button {
          margin-right: 0.5rem;
          margin-top: 0.5rem;
          border: 1px solid #700;
          background: none;
          color: #fff;
          padding: 0.4rem 1rem;
          cursor: pointer;
        }

        .actions button:hover {
          background: #900;
        }

        .details {
          display: none;
          margin-top: 1rem;
          border-top: 1px solid #400;
          padding-top: 1rem;
          opacity: 0.9;
        }

        input {
          background: #0d0000;
          border: 1px solid #700;
          color: #fff;
          padding: 0.6rem;
          width: 300px;
          margin-right: 1rem;
        }
    </style>
</head>
<body>

<h1>DECAYED SMP ADMIN</h1>

<nav>
    <button class="active" onclick="switchTab('apps')">Applications</button>
    <button onclick="switchTab('admins')">Admins</button>
</nav>

<!-- APPLICATIONS -->
<div id="apps" class="section active"></div>

<!-- ADMINS -->
<div id="admins" class="section">
    <input id="adminEmail" placeholder="email@example.com">
    <button onclick="addAdmin()">Add Admin</button>
    <div id="adminList" style="margin-top:2rem;"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
    import {
      getFirestore, collection, getDocs, doc,
      updateDoc, deleteDoc, setDoc, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";
    import {
      getAuth, onAuthStateChanged, signOut
    } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA2hzkK8CMcMCTPDGzcF5cqp8ulZRAlBZk",
      authDomain: "decayedsmp.firebaseapp.com",
      projectId: "decayedsmp"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const ADMIN_EMAIL = "e85972080@gmail.com";

    onAuthStateChanged(auth, user => {
      if (!user || user.email !== ADMIN_EMAIL) {
        signOut(auth);
        location.href = "adminregister.html";
      } else {
        loadApps();
        loadAdmins();
      }
    });

    window.switchTab = id => {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      event.target.classList.add('active');
    };

    async function loadApps() {
      const wrap = document.getElementById("apps");
      wrap.innerHTML = "";

      const snap = await getDocs(collection(db, "applications"));
      snap.forEach(d => {
        const a = d.data();

        wrap.innerHTML += `
          <div class="card">
            <h3>${a.type.toUpperCase()} APPLICATION</h3>
            <div class="meta">
              <strong>Name:</strong> ${a.name}<br>
              <strong>Age:</strong> ${a.age}<br>
              <strong>IGN:</strong> ${a.ign}<br>
              <strong>Discord:</strong> ${a.discord}
            </div>

            <div class="actions">
              <button onclick="setStatus('${d.id}','accepted')">Accept</button>
              <button onclick="setStatus('${d.id}','denied')">Deny</button>
              <button onclick="toggleDetails(this)">See More</button>
              <button onclick="deleteApp('${d.id}')">Delete</button>
            </div>

            <div class="details">
              <p><strong>Role youâ€™d play:</strong><br>${a.role}</p>
              <p><strong>RP Experience:</strong><br>${a.rpExperience}</p>
              <p><strong>Why:</strong><br>${a.reason}</p>
            </div>
          </div>
        `;
      });
    }

    window.toggleDetails = btn => {
      btn.parentElement.nextElementSibling.style.display =
        btn.parentElement.nextElementSibling.style.display === "block" ? "none" : "block";
    };

    window.setStatus = async (id, status) => {
      await updateDoc(doc(db, "applications", id), { status });
      loadApps();
    };

    window.deleteApp = async id => {
      if (confirm("Delete application?")) {
        await deleteDoc(doc(db, "applications", id));
        loadApps();
      }
    };

    async function loadAdmins() {
      const wrap = document.getElementById("adminList");
      wrap.innerHTML = "";
      const snap = await getDocs(collection(db, "admins"));
      snap.forEach(d => wrap.innerHTML += `<div>${d.id}</div>`);
    }

    window.addAdmin = async () => {
      const email = document.getElementById("adminEmail").value.trim();
      if (!email) return;
      await setDoc(doc(db, "admins", email), {
        email,
        addedAt: serverTimestamp()
      });
      document.getElementById("adminEmail").value = "";
      loadAdmins();
    };
</script>

</body>
</html>
